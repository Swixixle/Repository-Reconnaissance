{
  "prereqs": [
    "Node.js 20+",
    "npm",
    "PostgreSQL 14+",
    "yarn (alternative to npm, optional)",
    "drizzle-kit (for DB migration)",
    "tsx (for dev scripts and build)",
    "Git (implied for CI and code management)"
  ],
  "install_steps": [
    {
      "step": "Install Node.js 20+, npm, and PostgreSQL 14+ on your system.",
      "command": null,
      "evidence": {
        "path": "README.md",
        "line_start": 23,
        "line_end": 24,
        "snippet_hash": "684fad525f34",
        "display": "README.md:23-24"
      }
    },
    {
      "step": "Install dependencies.",
      "command": "npm install",
      "evidence": {
        "path": "README.md",
        "line_start": 29,
        "line_end": 29,
        "snippet_hash": "3a2dc0ae21eb",
        "display": "README.md:29"
      }
    }
  ],
  "config": [
    {
      "name": "DATABASE_URL",
      "purpose": "PostgreSQL connection string used by both the migration tool and runtime app.",
      "evidence": {
        "path": ".env.example",
        "line_start": 5,
        "line_end": 5,
        "snippet_hash": "aeaa5d08ab01",
        "display": ".env.example:5"
      }
    },
    {
      "name": "API_KEY",
      "purpose": "API key for authenticating private (non-public) endpoints.",
      "evidence": {
        "path": ".env.example",
        "line_start": 10,
        "line_end": 10,
        "snippet_hash": "eebb9b859fec",
        "display": ".env.example:10"
      }
    },
    {
      "name": "SESSION_SECRET",
      "purpose": "Secret key for session hashing in security audit\u2014must be cryptographically strong in production.",
      "evidence": {
        "path": ".env.example",
        "line_start": 23,
        "line_end": 23,
        "snippet_hash": "f7e2d4342e03",
        "display": ".env.example:23"
      }
    },
    {
      "name": "NODE_ENV",
      "purpose": "Controls the environment: development or production.",
      "evidence": {
        "path": ".env.example",
        "line_start": 13,
        "line_end": 13,
        "snippet_hash": "ad549f98b37b",
        "display": ".env.example:13"
      }
    },
    {
      "name": "PORT",
      "purpose": "HTTP server listen port (default: 5000).",
      "evidence": {
        "path": ".env.example",
        "line_start": 14,
        "line_end": 14,
        "snippet_hash": "d1fd3ffd349f",
        "display": ".env.example:14"
      }
    },
    {
      "name": "TRANSCRIPT_MODE",
      "purpose": "Transcript display mode\u2014options: full, redacted, hidden.",
      "evidence": {
        "path": ".env.example",
        "line_start": 18,
        "line_end": 18,
        "snippet_hash": "520a3db1dbde",
        "display": ".env.example:18"
      }
    },
    {
      "name": "REPLIT_CONNECTORS_HOSTNAME",
      "purpose": "Optional for GitHub integration, only needed if using GitHub connectors.",
      "evidence": {
        "path": ".env.example",
        "line_start": 27,
        "line_end": 27,
        "snippet_hash": "b992295a0561",
        "display": ".env.example:27"
      }
    },
    {
      "name": "REPL_IDENTITY",
      "purpose": "Optional for GitHub integration, only needed if using GitHub connectors.",
      "evidence": {
        "path": ".env.example",
        "line_start": 28,
        "line_end": 28,
        "snippet_hash": "642899eba5a4",
        "display": ".env.example:28"
      }
    },
    {
      "name": "WEB_REPL_RENEWAL",
      "purpose": "Optional for GitHub integration, only needed if using GitHub connectors.",
      "evidence": {
        "path": ".env.example",
        "line_start": 29,
        "line_end": 29,
        "snippet_hash": "30ec0e3c6118",
        "display": ".env.example:29"
      }
    },
    {
      "name": "CHECKPOINT_INTERVAL",
      "purpose": "Interval for Ed25519 checkpoint creation (every N events).",
      "evidence": {
        "path": "STATE.md",
        "line_start": 118,
        "line_end": 118,
        "snippet_hash": "333069fdf796",
        "display": "STATE.md:118"
      }
    },
    {
      "name": "CHECKPOINT_ANCHOR_TYPE",
      "purpose": "Configures backend for checkpoint anchoring (LogOnly, S3WormAnchor, Rfc3161TsaAnchor, MultiAnchor).",
      "evidence": {
        "path": "replit.md",
        "line_start": 45,
        "line_end": 45,
        "snippet_hash": "d9991dc12248",
        "display": "replit.md:45"
      }
    }
  ],
  "run_dev": [
    {
      "step": "Start development server.",
      "command": "npm run dev",
      "evidence": {
        "path": "README.md",
        "line_start": 44,
        "line_end": 44,
        "snippet_hash": "21f1677c8f4f",
        "display": "README.md:44"
      }
    },
    {
      "step": "Alternative (from Replit): Run using the workspace run button or workflow.",
      "command": "npm run dev",
      "evidence": {
        "path": ".replit",
        "line_start": 2,
        "line_end": 2,
        "snippet_hash": "96fa2e5505e4",
        "display": ".replit:2"
      }
    }
  ],
  "run_prod": [
    {
      "step": "Build the application.",
      "command": "npm run build",
      "evidence": {
        "path": "README.md",
        "line_start": 52,
        "line_end": 52,
        "snippet_hash": "290051cb4627",
        "display": "README.md:52"
      }
    },
    {
      "step": "Start production server (must set NODE_ENV=production).",
      "command": "npm run start",
      "evidence": {
        "path": "README.md",
        "line_start": 53,
        "line_end": 53,
        "snippet_hash": "505962fedbe9",
        "display": "README.md:53"
      }
    }
  ],
  "usage_examples": [
    {
      "description": "Health check (liveness): should always return 200.",
      "command": "curl http://localhost:5000/api/health",
      "evidence": "docs/API_CONTRACTS.md:9-21"
    },
    {
      "description": "Readiness check (verifies DB & audit head).",
      "command": "curl http://localhost:5000/api/ready",
      "evidence": "docs/API_CONTRACTS.md:22-35"
    },
    {
      "description": "Verify audit chain integrity (requires API key).",
      "command": "curl -H \"x-api-key: $API_KEY\" http://localhost:5000/api/audit/verify",
      "evidence": "docs/API_CONTRACTS.md:64-79"
    },
    {
      "description": "Export forensic pack (CLI utility) for audit/export testing.",
      "command": "npx tsx scripts/export_forensic_pack.ts --output pack.json",
      "evidence": "scripts/ci-forensic-gate.sh:42"
    },
    {
      "description": "Offline verify of forensic pack.",
      "command": "npx tsx scripts/verify_forensic_pack.ts pack.json",
      "evidence": "scripts/ci-forensic-gate.sh:52"
    }
  ],
  "verification_steps": [
    {
      "step": "Check health endpoint returns status: ok.",
      "command": "curl http://localhost:5000/api/health",
      "evidence": {
        "path": "docs/API_CONTRACTS.md",
        "line_start": 9,
        "line_end": 21,
        "snippet_hash": "7d7ddcba8038",
        "display": "docs/API_CONTRACTS.md:9-21"
      }
    },
    {
      "step": "Check readiness endpoint returns DB and audit status.",
      "command": "curl http://localhost:5000/api/ready",
      "evidence": {
        "path": "docs/API_CONTRACTS.md",
        "line_start": 22,
        "line_end": 35,
        "snippet_hash": "66f70c1ce5e6",
        "display": "docs/API_CONTRACTS.md:22-35"
      }
    },
    {
      "step": "Verify audit chain using API with API key.",
      "command": "curl -H \"x-api-key: $API_KEY\" http://localhost:5000/api/audit/verify",
      "evidence": {
        "path": "docs/API_CONTRACTS.md",
        "line_start": 64,
        "line_end": 79,
        "snippet_hash": "f6e8059d9704",
        "display": "docs/API_CONTRACTS.md:64-79"
      }
    },
    {
      "step": "Export a forensic pack and verify offline.",
      "command": "npx tsx scripts/export_forensic_pack.ts --output test.json && npx tsx scripts/verify_forensic_pack.ts test.json",
      "evidence": {
        "path": "scripts/ci-forensic-gate.sh",
        "line_start": 42,
        "line_end": 42,
        "snippet_hash": "d37376e1a8f9",
        "display": "scripts/ci-forensic-gate.sh:42"
      }
    },
    {
      "step": "Tamper with forensic pack and confirm detection.",
      "command": "python3 -c \"import json; pack=json.load(open('test.json')); pack['events'][0]['action']='TAMPERED'; json.dump(pack, open('tampered.json','w'))\" && npx tsx scripts/verify_forensic_pack.ts tampered.json",
      "evidence": {
        "path": "scripts/ci-forensic-gate.sh",
        "line_start": 65,
        "line_end": 77,
        "snippet_hash": "ca4cf9cad5be",
        "display": "scripts/ci-forensic-gate.sh:65-77"
      }
    }
  ],
  "common_failures": [
    {
      "symptom": "API returns error 'database unavailable' or 503 on /api/ready.",
      "cause": "PostgreSQL is not running or DATABASE_URL incorrect.",
      "fix": "Confirm the database is running and DATABASE_URL is correct."
    },
    {
      "symptom": "Private API endpoints return authentication error.",
      "cause": "API_KEY missing or incorrect in request.",
      "fix": "Add the correct x-api-key header using value from the .env file."
    },
    {
      "symptom": "Audit verification reports 'BROKEN' status.",
      "cause": "Data in the audit trail was tampered, or a DB admin modified records.",
      "fix": "Investigate database for unauthorized changes; restore from backup if needed."
    },
    {
      "symptom": "'dev' or 'start' script fails with missing module or tsx error.",
      "cause": "Dependencies not installed or environment mismatch.",
      "fix": "Run npm install; ensure Node.js version is correct."
    }
  ],
  "unknowns": [
    {
      "what_is_missing": "Explicit migration/init commands for setting up initial database schema (beyond running db:push).",
      "why_it_matters": "Operators need to know concrete database bootstrap/init steps (if any migration configs or custom scripts are required).",
      "what_evidence_needed": "Lines describing a migration run, e.g., drizzle-kit push with specific environment, or manual schema SQL."
    },
    {
      "what_is_missing": "Frontend build/test/deploy steps for running a full production deployment with static files.",
      "why_it_matters": "Production deploy may need more than just the backend start, e.g., Vite or static build for client.",
      "what_evidence_needed": "Docs or scripts lines showing frontend build (vite, next, etc.), and static hosting/deploy."
    }
  ],
  "missing_evidence_requests": [
    "Full database migration/bootstrap commands not explicitly documented.",
    "End-to-end production deployment steps for serving both backend and frontend together are not fully specified.",
    "No evidence showing how environment variables are securely provided in hosted or containerized environments.",
    "No concrete log file locations or log management setup mentioned.",
    "Absence of backup/restore procedures for the database.",
    "Systemd or orchestrator (docker/k8s) recipes for process management are not included.",
    "How to rotate/check Ed25519 keys for checkpoint signing beyond CI/test scripts.",
    "How API_KEY is distributed or secrets management in a team context."
  ],
  "completeness": {
    "score": 79,
    "max": 100,
    "missing": [
      "port_behavior: no port evidence with verified snippet_hash"
    ],
    "deductions": [
      "-6 for 2 unknown(s)"
    ],
    "notes": "-6 for 2 unknown(s); No Dockerfile found; 2 unknown(s) reported"
  }
}