{
  "prereqs": [
    "Node.js 20+ (for Express/React app, scripts, server)",
    "Python 3.11+ (for analyzer CLI and evidence extraction)",
    "npm (for managing JS dependencies)",
    "PostgreSQL 14+ (for persistent storage)",
    "jq, unzip (for forensic scripts and ops utilities)",
    "TypeScript (for type checking, building frontend and backend)",
    "tsc, tsx, drizzle-kit (as npm dev tools)"
  ],
  "install_steps": [
    {
      "step": "Clone the repository",
      "command": "git clone <repo-url> && cd <repo-dir>",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 86,
        "line_end": 86,
        "snippet_hash": "af4db2203afc",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:86"
      }
    },
    {
      "step": "Install Node.js dependencies",
      "command": "npm install",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 88,
        "line_end": 88,
        "snippet_hash": "4be7c6195f60",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:88"
      }
    },
    {
      "step": "Install Python package in editable mode (registers the 'pta' CLI)",
      "command": "pip install -e .",
      "evidence": {
        "path": "README.md",
        "line_start": 25,
        "line_end": 25,
        "snippet_hash": "92755120ac2c",
        "display": "README.md:25"
      }
    },
    {
      "step": "Copy environment variable template",
      "command": "cp .env.example .env",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 89,
        "line_end": 89,
        "snippet_hash": "232f2a0c483a",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:89"
      }
    },
    {
      "step": "Edit .env to set DATABASE_URL, API_KEY, SESSION_SECRET, and other required or optional vars",
      "command": "nano .env",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 91,
        "line_end": 91,
        "snippet_hash": "ecd94c8e718d",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:91"
      }
    },
    {
      "step": "Apply database schema migrations",
      "command": "npm run db:push",
      "evidence": {
        "path": "package.json",
        "line_start": 11,
        "line_end": 11,
        "snippet_hash": "3a8be55004c2",
        "display": "package.json:11"
      }
    }
  ],
  "config": [
    {
      "name": "DATABASE_URL",
      "purpose": "Connection string for PostgreSQL; required for backend and audit logging",
      "evidence": {
        "path": "drizzle.config.ts",
        "line_start": 3,
        "line_end": 3,
        "snippet_hash": "a19790628fbe",
        "display": "drizzle.config.ts:3"
      }
    },
    {
      "name": "API_KEY",
      "purpose": "Secret key required for all non-public API endpoints (authenticates HTTP requests)",
      "evidence": ".env.example:10"
    },
    {
      "name": "SESSION_SECRET",
      "purpose": "Secret for session cookie encryption; required for Express session security",
      "evidence": ".env.example:23"
    },
    {
      "name": "NODE_ENV",
      "purpose": "Sets either development or production mode for server, affects logging and behavior",
      "evidence": ".env.example:13"
    },
    {
      "name": "PORT",
      "purpose": "Port on which the web server runs (default 5000)",
      "evidence": ".env.example:14"
    },
    {
      "name": "AI_INTEGRATIONS_OPENAI_API_KEY",
      "purpose": "API key for LLM/AI features (OpenAI integration, required unless --no-llm)",
      "evidence": {
        "path": "README.md",
        "line_start": 85,
        "line_end": 85,
        "snippet_hash": "7fb69856946c",
        "display": "README.md:85"
      }
    },
    {
      "name": "AI_INTEGRATIONS_OPENAI_BASE_URL",
      "purpose": "Base URL for OpenAI API endpoints",
      "evidence": {
        "path": "README.md",
        "line_start": 86,
        "line_end": 86,
        "snippet_hash": "e3b0c44298fc",
        "display": "README.md:86"
      }
    }
  ],
  "run_dev": [
    {
      "step": "Start development server (Node.js, React frontend via Vite, backend via Express)",
      "command": "npm run dev",
      "evidence": {
        "path": "package.json",
        "line_start": 7,
        "line_end": 7,
        "snippet_hash": "fd240a9dc053",
        "display": "package.json:7"
      }
    },
    {
      "step": "Run analyzer CLI (Python, as installed module)",
      "command": "pta analyze --replit -o ./output",
      "evidence": {
        "path": "README.md",
        "line_start": 56,
        "line_end": 56,
        "snippet_hash": "4bc5d8e7df37",
        "display": "README.md:56"
      }
    },
    {
      "step": "Alternately, invoke analyzer CLI directly",
      "command": "python -m server.analyzer.src --help",
      "evidence": {
        "path": "README.md",
        "line_start": 31,
        "line_end": 31,
        "snippet_hash": "235fdc0ab0a3",
        "display": "README.md:31"
      }
    }
  ],
  "run_prod": [
    {
      "step": "Build frontend and backend for production",
      "command": "npm run build",
      "evidence": {
        "path": "package.json",
        "line_start": 8,
        "line_end": 8,
        "snippet_hash": "79d8bdf275d6",
        "display": "package.json:8"
      }
    },
    {
      "step": "Set NODE_ENV=production and run the production server",
      "command": "npm run start",
      "evidence": {
        "path": "package.json",
        "line_start": 9,
        "line_end": 9,
        "snippet_hash": "020435ddf436",
        "display": "package.json:9"
      }
    },
    {
      "step": "Serve on port set by PORT environment variable (default 5000)",
      "command": "unknown",
      "evidence": null
    }
  ],
  "usage_examples": [
    {
      "description": "Run analyzer in deterministic mode against a Replit workspace, output to ./output",
      "command": "pta analyze --replit --no-llm -o ./output"
    },
    {
      "description": "Run analyzer against a public GitHub repository",
      "command": "pta analyze https://github.com/user/repo -o ./output"
    },
    {
      "description": "Health check endpoint for verifying backend readiness",
      "command": "curl http://localhost:5000/api/health"
    },
    {
      "description": "Verify audit chain (requires x-api-key header with API_KEY value)",
      "command": "curl -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/audit/verify"
    },
    {
      "description": "Export forensic data pack for offline verification",
      "command": "npx tsx scripts/export_forensic_pack.ts --output pack.json"
    }
  ],
  "verification_steps": [
    {
      "step": "Smoke test: verify all three analyzer CLI entrypoints and check output files",
      "command": "bash scripts/smoke_test.sh",
      "evidence": {
        "path": "attached_assets/Pasted-Got-it-Copilot-said-it-did-it-but-you-need-reproducible_1771067676312.txt",
        "line_start": 154,
        "line_end": 154,
        "snippet_hash": "e3b0c44298fc",
        "display": "attached_assets/Pasted-Got-it-Copilot-said-it-did-it-but-you-need-reproducible_1771067676312.txt:154"
      }
    },
    {
      "step": "Check backend availability via health endpoint",
      "command": "curl http://localhost:5000/api/health",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 128,
        "line_end": 128,
        "snippet_hash": "4994405dd75c",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:128"
      }
    },
    {
      "step": "Check audit log verification endpoint (requires API_KEY)",
      "command": "curl -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/audit/verify",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 140,
        "line_end": 140,
        "snippet_hash": "66a8604b5116",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:140"
      }
    }
  ],
  "common_failures": [
    {
      "symptom": "401 Unauthorized error from API endpoints",
      "cause": "Wrong or missing API_KEY in HTTP header",
      "fix": "Set the correct x-api-key header, check .env to ensure API_KEY is present"
    },
    {
      "symptom": "Database connection errors or crash",
      "cause": "Bad DATABASE_URL, database offline, or wrong credentials",
      "fix": "Check credentials, ensure PostgreSQL is running and accessible"
    },
    {
      "symptom": "Server not running or unable to bind to port",
      "cause": "App not started, port in use, misconfigured PORT variable",
      "fix": "Check logs, ensure PORT=5000 is set, use a free port"
    },
    {
      "symptom": "ModuleNotFoundError: core in analyzer scripts",
      "cause": "Python path or package init files are missing/broken",
      "fix": "Ensure __init__.py files (see attached_assets for packaging steps/completion)"
    },
    {
      "symptom": "Forensic pack tampering not detected during verification",
      "cause": "Audit bug or verification script out of sync or not installed",
      "fix": "Re-export pack, re-run verification script, ensure scripts up to date"
    }
  ],
  "unknowns": [
    {
      "what_is_missing": "Production deployment (systemd, Docker, PM2 or reverse proxy) instructions outside Replit and npm ecosphere",
      "why_it_matters": "Necessary for production-grade, non-Replit or containerized deployments and ops automation",
      "what_evidence_needed": "A Dockerfile, systemd unit, or hosting/reverse-proxy config showing how to run the app in classic production"
    },
    {
      "what_is_missing": "Log file path or log viewing/rotation commands",
      "why_it_matters": "Troubleshooting, long-term ops, and support require interactive log access",
      "what_evidence_needed": "Backend code/config with log file path, or READMEs describing log retrieval/tail"
    },
    {
      "what_is_missing": "Standalone front-end build/deploy instructions for split hosting (i.e. if you want to run just the frontend elsewhere)",
      "why_it_matters": "Applicable for static site hosting or alternate deployment/serving strategies",
      "what_evidence_needed": "Documentation or scripts for Vite build, static deploy, or external CDN hosting"
    },
    {
      "what_is_missing": "Outbound webhook/event/push integration config (e.g. for SIEM/alerting)",
      "why_it_matters": "Extensible integrations into broader security/ops platforms",
      "what_evidence_needed": "Config or code showing outbound webhooks, events, or integration guides"
    },
    {
      "what_is_missing": "Explicit log/metrics/observability endpoint(s) for the analyzer itself",
      "why_it_matters": "System introspection/observability is crucial for running any critical ops service",
      "what_evidence_needed": "Endpoints like /metrics, logging middleware setup, log access documentation"
    },
    {
      "what_is_missing": "Database/user privilege and custom DB initialization beyond drizzle-kit migrations",
      "why_it_matters": "Important for secure/robust DB setup in enterprise environments",
      "what_evidence_needed": "SQL setup guides, example user/role grants, or privileged schema docs"
    },
    {
      "what_is_missing": "Key rotation/generation procedure for API_KEY or SESSION_SECRET",
      "why_it_matters": "Long-term security operations and rotation requirements",
      "what_evidence_needed": "Step-by-step documentation or scripts for secure key/env value generation and rotation"
    }
  ],
  "missing_evidence_requests": [
    "No production deployment artifact found (Dockerfile/systemd config missing)",
    "No log access/viewing/rotation documentation found",
    "No standalone front-end hosting/build output/manual found",
    "No evidence of webhook/outbound event integration found",
    "No analyzer observability endpoint (metrics/logs) found in code or docs",
    "No privileged database user initialization docs/scripts found",
    "No key rotation procedure documentation for API_KEY/SESSION_SECRET found"
  ],
  "completeness": {
    "score": 70,
    "max": 100,
    "missing": [
      "port_behavior: no port evidence with verified snippet_hash"
    ],
    "deductions": [
      "-15 for 7 unknown(s)"
    ],
    "notes": "-15 for 7 unknown(s); 7 unknown(s) reported"
  }
}