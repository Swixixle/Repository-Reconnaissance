{
  "prereqs": [
    "Node.js 20+",
    "PostgreSQL 14+",
    "npm or yarn",
    "Drizzle ORM (as JS dep, auto-installed)",
    "Unix tools (curl, python3, jq, unzip for CI/ops scripts)",
    "tsx (for running TypeScript node scripts, as dev dependency)",
    "Recommended: Git, Replit (optional for fast onboarding), build chain for optional features"
  ],
  "install_steps": [
    {
      "step": "Install Node.js and npm (or yarn), ensure PostgreSQL is accessible",
      "command": null,
      "evidence": {
        "path": "README.md",
        "line_start": 23,
        "line_end": 25,
        "snippet_hash": "0794f4df286f",
        "display": "README.md:23-25"
      }
    },
    {
      "step": "Install NPM dependencies",
      "command": "npm install",
      "evidence": {
        "path": "README.md",
        "line_start": 29,
        "line_end": 29,
        "snippet_hash": "3a2dc0ae21eb",
        "display": "README.md:29"
      }
    }
  ],
  "config": [
    {
      "name": "DATABASE_URL",
      "purpose": "PostgreSQL connection string; points backend and Drizzle ORM to the correct database",
      "evidence": {
        "path": ".env.example",
        "line_start": 5,
        "line_end": 5,
        "snippet_hash": "aeaa5d08ab01",
        "display": ".env.example:5"
      }
    },
    {
      "name": "API_KEY",
      "purpose": "API key for authenticating private endpoints (required for anything but public verify/health/liveness); NEVER logged or exposed; default for dev: 'dev-test-key-12345'",
      "evidence": {
        "path": ".env.example",
        "line_start": 10,
        "line_end": 10,
        "snippet_hash": "eebb9b859fec",
        "display": ".env.example:10"
      }
    },
    {
      "name": "SESSION_SECRET",
      "purpose": "Session signing/hashing secret for application/session security",
      "evidence": {
        "path": ".env.example",
        "line_start": 23,
        "line_end": 23,
        "snippet_hash": "f7e2d4342e03",
        "display": ".env.example:23"
      }
    },
    {
      "name": "NODE_ENV",
      "purpose": "Selects environment (development/production); production uses optimized builds and stricter config",
      "evidence": {
        "path": ".env.example",
        "line_start": 13,
        "line_end": 13,
        "snippet_hash": "ad549f98b37b",
        "display": ".env.example:13"
      }
    },
    {
      "name": "PORT",
      "purpose": "HTTP listen port for the application",
      "evidence": {
        "path": ".env.example",
        "line_start": 14,
        "line_end": 14,
        "snippet_hash": "d1fd3ffd349f",
        "display": ".env.example:14"
      }
    },
    {
      "name": "TRANSCRIPT_MODE",
      "purpose": "UI/endpoint display mode for transcripts: full, redacted, or hidden",
      "evidence": {
        "path": ".env.example",
        "line_start": 18,
        "line_end": 18,
        "snippet_hash": "520a3db1dbde",
        "display": ".env.example:18"
      }
    },
    {
      "name": "REPLIT_CONNECTORS_HOSTNAME / REPL_IDENTITY / WEB_REPL_RENEWAL",
      "purpose": "GitHub integration (optional, only if connectors used in deployment)",
      "evidence": {
        "path": ".env.example",
        "line_start": 27,
        "line_end": 29,
        "snippet_hash": "0ebfefe42fb5",
        "display": ".env.example:27-29"
      }
    }
  ],
  "run_dev": [
    {
      "step": "Start development server (with hot reload, dev error overlays etc.)",
      "command": "npm run dev",
      "evidence": {
        "path": "README.md",
        "line_start": 44,
        "line_end": 44,
        "snippet_hash": "21f1677c8f4f",
        "display": "README.md:44"
      }
    }
  ],
  "run_prod": [
    {
      "step": "Build production-optimized server bundle",
      "command": "npm run build",
      "evidence": {
        "path": "README.md",
        "line_start": 52,
        "line_end": 52,
        "snippet_hash": "290051cb4627",
        "display": "README.md:52"
      }
    },
    {
      "step": "Run production server",
      "command": "npm run start",
      "evidence": {
        "path": "README.md",
        "line_start": 53,
        "line_end": 53,
        "snippet_hash": "505962fedbe9",
        "display": "README.md:53"
      }
    }
  ],
  "usage_examples": [
    {
      "description": "List all receipts (paginated, filterable, requires API_KEY)",
      "command": "curl -H 'x-api-key: <API_KEY>' http://localhost:5000/api/receipts",
      "evidence": "docs/API_CONTRACTS.md:84-92"
    },
    {
      "description": "Verify audit chain integrity (requires API_KEY)",
      "command": "curl -H 'x-api-key: <API_KEY>' http://localhost:5000/api/audit/verify",
      "evidence": "docs/API_CONTRACTS.md:64-73"
    },
    {
      "description": "Publicly verify a receipt's hash (no auth required)",
      "command": "curl -X POST http://localhost:5000/api/public/verify -d @receipt.json",
      "evidence": "docs/API_CONTRACTS.md:174-182"
    },
    {
      "description": "Health check endpoint (no auth, liveness)",
      "command": "curl http://localhost:5000/api/health",
      "evidence": "docs/API_CONTRACTS.md:9-19"
    },
    {
      "description": "Export and verify a forensic pack via scripts",
      "command": "npx tsx scripts/export_forensic_pack.ts --output /tmp/pack.json && npx tsx scripts/verify_forensic_pack.ts /tmp/pack.json",
      "evidence": "scripts/ci-forensic-gate.sh:42,52"
    }
  ],
  "verification_steps": [
    {
      "step": "Run all tests (E2E, golden, proof, anchors, regulatory)",
      "command": "npx vitest run --config vitest.config.ts",
      "evidence": {
        "path": "STATE.md",
        "line_start": 212,
        "line_end": 212,
        "snippet_hash": "c5ecd9b8799f",
        "display": "STATE.md:212"
      }
    },
    {
      "step": "Call health/ready endpoints to verify liveness and readiness",
      "command": "curl http://localhost:5000/api/health && curl http://localhost:5000/api/ready",
      "evidence": {
        "path": "STATE.md",
        "line_start": 204,
        "line_end": 205,
        "snippet_hash": "9ace86ef8825",
        "display": "STATE.md:204-205"
      }
    },
    {
      "step": "Verify audit trail (call live endpoint, expect 'ok', 'checked', 'totalEvents' in JSON)",
      "command": "curl -H 'x-api-key: <API_KEY>' http://localhost:5000/api/audit/verify",
      "evidence": {
        "path": "STATE.md",
        "line_start": 206,
        "line_end": 206,
        "snippet_hash": "b0dfc20038ac",
        "display": "STATE.md:206"
      }
    },
    {
      "step": "Export forensic pack, run offline verifier (tampering test optional)",
      "command": "npx tsx scripts/export_forensic_pack.ts --output /tmp/pack.json && npx tsx scripts/verify_forensic_pack.ts /tmp/pack.json",
      "evidence": {
        "path": "scripts/ci-forensic-gate.sh",
        "line_start": 42,
        "line_end": 42,
        "snippet_hash": "d37376e1a8f9",
        "display": "scripts/ci-forensic-gate.sh:42"
      }
    }
  ],
  "common_failures": [
    {
      "symptom": "API endpoint returns 503 or readiness probe fails",
      "cause": "PostgreSQL not running or wrong DATABASE_URL",
      "fix": "Start PostgreSQL and check/update DATABASE_URL in .env",
      "evidence": {
        "path": "SECURITY.md",
        "line_start": 82,
        "line_end": 82,
        "snippet_hash": "6ccbb810470f",
        "display": "SECURITY.md:82"
      }
    },
    {
      "symptom": "Private endpoint returns 401/403",
      "cause": "Missing or wrong API_KEY in header",
      "fix": "Set correct API_KEY in .env and in 'x-api-key' header",
      "evidence": {
        "path": "SECURITY.md",
        "line_start": 72,
        "line_end": 72,
        "snippet_hash": "37e5ee1c04fb",
        "display": "SECURITY.md:72"
      }
    },
    {
      "symptom": "Cannot interpret/lock/kill-switch a receipt",
      "cause": "Receipt is not verified or is kill-switched/locked",
      "fix": "First verify, do not attempt action on locked/kill-switched receipts",
      "evidence": "SECURITY.md:143,168,133, docs/API_CONTRACTS.md:143,166,133"
    },
    {
      "symptom": "Audit verify endpoint returns BROKEN or firstBadSeq != null",
      "cause": "Audit trail has been tampered with (deleted/modified rows, version mismatch)",
      "fix": "Restore DB, investigate operator/admin actions, check for privileged access abuse",
      "evidence": {
        "path": "STATE.md",
        "line_start": 209,
        "line_end": 209,
        "snippet_hash": "ed4c152781c9",
        "display": "STATE.md:209"
      }
    },
    {
      "symptom": "Rate limit errors (429)",
      "cause": "Too many requests to public or verify endpoints",
      "fix": "Wait and retry; review rate limits in SECURITY.md",
      "evidence": {
        "path": "SECURITY.md",
        "line_start": 27,
        "line_end": 29,
        "snippet_hash": "ad79f3e9ee2d",
        "display": "SECURITY.md:27-29"
      }
    }
  ],
  "unknowns": [
    {
      "what_is_missing": "Frontend build/start specifics (how client built in production, if any static hosting required)",
      "why_it_matters": "Operator may need to serve static assets separately, or configure double server/proxy setup",
      "what_evidence_needed": "Explicit frontend deployment/run steps and expected hosting approach"
    },
    {
      "what_is_missing": "Detailed DB schema/init commands beyond Drizzle push",
      "why_it_matters": "Necessary for full DB state bootstrap and recurring migrations",
      "what_evidence_needed": "Initial SQL schema or migration strategy confirmation"
    },
    {
      "what_is_missing": "How to obtain/rotate prod API keys and session secrets securely",
      "why_it_matters": "Security critical for production rollouts",
      "what_evidence_needed": "Process, tooling, or script to (re-)generate credentials"
    }
  ],
  "missing_evidence_requests": [
    "Frontend build and hosting steps for production (exact commands beyond 'npm run build' for server)",
    "Database bootstrap/init details if DB is empty",
    "Scripts/methods for secure API key/secret rotation",
    "User/role management instructions (if any UI/admin controls exist)"
  ],
  "completeness": {
    "score": 76,
    "max": 100,
    "missing": [
      "port_behavior: no port evidence with verified snippet_hash"
    ],
    "deductions": [
      "-9 for 3 unknown(s)"
    ],
    "notes": "-9 for 3 unknown(s); No Dockerfile found; 3 unknown(s) reported"
  }
}