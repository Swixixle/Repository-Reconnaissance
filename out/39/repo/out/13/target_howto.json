{
  "prereqs": [
    "Node.js 20+ and npm (for JS/TS monorepo) (docs/dossiers/lantern_program_totality_dossier.md:79; .replit:1)",
    "PostgreSQL 14+ (docs/dossiers/lantern_program_totality_dossier.md:80; README.md:24; .replit:1)",
    "python3 (for operator scripts and analyzer, not runtime of main app) (docs/dossiers/lantern_program_totality_dossier.md:81; .replit:1)",
    "jq, unzip (for export/ops scripts; only if those scripts are run) (docs/dossiers/lantern_program_totality_dossier.md:81; .replit:7)",
    "TypeScript, tsx, drizzle-kit (installed via npm as devDependencies, for development/build/migrations) (docs/dossiers/lantern_program_totality_dossier.md:82; package.json:6,99,103)",
    "AI Integrations OpenAI API key and base URL (for LLM features, only if using LLM-powered analysis) (replit.md:101-103)"
  ],
  "install_steps": [
    {
      "step": "Clone repository",
      "command": "git clone <repo-url>",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 86,
        "line_end": 86,
        "snippet_hash": "af4db2203afc",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:86"
      }
    },
    {
      "step": "Install node dependencies",
      "command": "npm install",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 87,
        "line_end": 88,
        "snippet_hash": "4e60fcc46ada",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:87-88"
      }
    },
    {
      "step": "Copy example env file",
      "command": "cp .env.example .env",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 89,
        "line_end": 89,
        "snippet_hash": "232f2a0c483a",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:89"
      }
    },
    {
      "step": "Edit .env file with required secrets and config",
      "command": "edit .env",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 91,
        "line_end": 92,
        "snippet_hash": "ff28a61c3197",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:91-92"
      }
    },
    {
      "step": "Database: Apply schema using drizzle-kit",
      "command": "npm run db:push",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 108,
        "line_end": 108,
        "snippet_hash": "e73ea833158b",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:108"
      }
    }
  ],
  "config": [
    {
      "name": "DATABASE_URL",
      "purpose": "PostgreSQL connection string",
      "evidence": {
        "path": "drizzle.config.ts",
        "line_start": 3,
        "line_end": 3,
        "snippet_hash": "a19790628fbe",
        "display": "drizzle.config.ts:3"
      }
    },
    {
      "name": "API_KEY",
      "purpose": "Required for private API endpoints; used in x-api-key header",
      "evidence": ".env.example:10; docs/dossiers/lantern_program_totality_dossier.md:100; SECURITY.md:15"
    },
    {
      "name": "SESSION_SECRET",
      "purpose": "Session secret for express-session; must be strong and random",
      "evidence": ".env.example:23; docs/dossiers/lantern_program_totality_dossier.md:101; SECURITY.md:71"
    },
    {
      "name": "NODE_ENV",
      "purpose": "Selects development or production mode",
      "evidence": ".env.example:13; docs/dossiers/lantern_program_totality_dossier.md:102"
    },
    {
      "name": "PORT",
      "purpose": "Server port (default 5000, mapped to 80 on Replit)",
      "evidence": ".env.example:14; .replit:10,14; docs/dossiers/lantern_program_totality_dossier.md:103"
    },
    {
      "name": "AI_INTEGRATIONS_OPENAI_API_KEY",
      "purpose": "OpenAI API key for LLM integration (if using LLM-powered features)",
      "evidence": {
        "path": "server/replit_integrations/audio/client.ts",
        "line_start": 10,
        "line_end": 10,
        "snippet_hash": "05da5f1b1281",
        "display": "server/replit_integrations/audio/client.ts:10"
      }
    },
    {
      "name": "AI_INTEGRATIONS_OPENAI_BASE_URL",
      "purpose": "Base URL for OpenAI API (if using LLM-powered features)",
      "evidence": {
        "path": "server/replit_integrations/audio/client.ts",
        "line_start": 11,
        "line_end": 11,
        "snippet_hash": "1f70e6a77d42",
        "display": "server/replit_integrations/audio/client.ts:11"
      }
    }
  ],
  "run_dev": [
    {
      "step": "Run development server (Node/Express/React/Vite)",
      "command": "npm run dev",
      "evidence": {
        "path": ".replit",
        "line_start": 2,
        "line_end": 2,
        "snippet_hash": "96fa2e5505e4",
        "display": ".replit:2"
      }
    }
  ],
  "run_prod": [
    {
      "step": "Build frontend and backend bundles",
      "command": "npm run build",
      "evidence": {
        "path": "package.json",
        "line_start": 8,
        "line_end": 8,
        "snippet_hash": "79d8bdf275d6",
        "display": "package.json:8"
      }
    },
    {
      "step": "Start production server",
      "command": "npm run start",
      "evidence": {
        "path": "package.json",
        "line_start": 9,
        "line_end": 9,
        "snippet_hash": "020435ddf436",
        "display": "package.json:9"
      }
    }
  ],
  "usage_examples": [
    {
      "description": "Check API health endpoint",
      "command": "curl http://localhost:5000/api/health"
    },
    {
      "description": "Check API readiness endpoint",
      "command": "curl http://localhost:5000/api/ready"
    },
    {
      "description": "Verify audit chain (API_KEY needed)",
      "command": "curl -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/audit/verify"
    },
    {
      "description": "Export forensic pack (TypeScript script)",
      "command": "npx tsx scripts/export_forensic_pack.ts --output <pack.json>"
    },
    {
      "description": "Offline verify forensic pack (TypeScript script)",
      "command": "npx tsx scripts/verify_forensic_pack.ts <pack.json>"
    }
  ],
  "verification_steps": [
    {
      "step": "Check database schema is applied",
      "command": "npm run db:push",
      "evidence": {
        "path": "package.json",
        "line_start": 11,
        "line_end": 11,
        "snippet_hash": "3a8be55004c2",
        "display": "package.json:11"
      }
    },
    {
      "step": "Health check endpoint returns 200",
      "command": "curl http://localhost:5000/api/health",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 128,
        "line_end": 128,
        "snippet_hash": "4994405dd75c",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:128"
      }
    },
    {
      "step": "Verify audit chain via API",
      "command": "curl -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/audit/verify",
      "evidence": {
        "path": "docs/dossiers/lantern_program_totality_dossier.md",
        "line_start": 140,
        "line_end": 140,
        "snippet_hash": "66a8604b5116",
        "display": "docs/dossiers/lantern_program_totality_dossier.md:140"
      }
    },
    {
      "step": "Run forensic pack export/verify scripts",
      "command": "npx tsx scripts/export_forensic_pack.ts --output <pack.json> && npx tsx scripts/verify_forensic_pack.ts <pack.json>",
      "evidence": "scripts/ci-forensic-gate.sh:42"
    }
  ],
  "common_failures": [
    {
      "symptom": "401 Unauthorized",
      "cause": "Wrong or missing API_KEY",
      "fix": "Set correct x-api-key header, check .env",
      "evidence": "SECURITY.md:15"
    },
    {
      "symptom": "DB connection errors/crash",
      "cause": "Bad DATABASE_URL, DB offline/wrong",
      "fix": "Check credentials, service, version",
      "evidence": {
        "path": "drizzle.config.ts",
        "line_start": 3,
        "line_end": 3,
        "snippet_hash": "a19790628fbe",
        "display": "drizzle.config.ts:3"
      }
    },
    {
      "symptom": "Server not running on port",
      "cause": "App not started, port conflict",
      "fix": "Check logs, ensure PORT=5000, check if in use",
      "evidence": {
        "path": ".replit",
        "line_start": 10,
        "line_end": 10,
        "snippet_hash": "47abfb4488e8",
        "display": ".replit:10"
      }
    },
    {
      "symptom": "Forensic pack tamper undetected",
      "cause": "Bug or script not installed",
      "fix": "Re-export, ensure proper script in place",
      "evidence": "scripts/ci-forensic-gate.sh:61-84"
    }
  ],
  "unknowns": [
    {
      "what_is_missing": "Production deployment details (systemd/Docker/PM2/Replit vs non-Replit hosting details)",
      "why_it_matters": "Critical for operators outside Replit; affects long-term ops, scaling, maintenance",
      "what_evidence_needed": "A Dockerfile, systemd service, or reverse proxy config; ops guide for bare-metal production"
    },
    {
      "what_is_missing": "Database initialization beyond drizzle-kit (custom roles/users, stateful setup steps)",
      "why_it_matters": "Might affect production db permissions, backup, compliance, etc.",
      "what_evidence_needed": "Custom migration scripts, role guides, SQL init documentation"
    },
    {
      "what_is_missing": "Key rotation and management procedures for API_KEY, SESSION_SECRET",
      "why_it_matters": "Essential for secure operations, incident response, compliance",
      "what_evidence_needed": "Step-by-step key management and rotation documentation"
    },
    {
      "what_is_missing": "Log file locations or log viewing commands",
      "why_it_matters": "Troubleshooting and support",
      "what_evidence_needed": "Sample commands to view/monitor logs, or explicit log file paths"
    },
    {
      "what_is_missing": "Standalone frontend build/hosting/deploy commands (for a frontend-only deployment)",
      "why_it_matters": "Helpful for static hosting, PaaS, or CDN deployment not coupled with Express server",
      "what_evidence_needed": "Documented build/start process for client-only, production hosting instructions"
    },
    {
      "what_is_missing": "Webhooks or outbound integration events",
      "why_it_matters": "Would affect SIEM/SOC, alerting, ops integration",
      "what_evidence_needed": "Webhook config/doc/examples/sample code"
    }
  ],
  "missing_evidence_requests": [
    "No production deployment strategy found (Dockerfile/systemd/PM2 missing)",
    "No evidence for database custom init, roles or backup steps (beyond drizzle-kit)",
    "No key rotation/management procedures for API_KEY or SESSION_SECRET",
    "No log path/viewing evidence for server log output",
    "No standalone frontend hosting or build instructions for client-only",
    "No webhook or outbound event integration evidence found"
  ],
  "replit_execution_profile": {
    "run_command": "npm run dev",
    "language": "nodejs",
    "port_binding": {
      "port": null,
      "binds_all_interfaces": true,
      "uses_env_port": true,
      "evidence": [
        {
          "path": "server/index.ts",
          "line_start": 92,
          "line_end": 92,
          "snippet_hash": "75d345a78f84",
          "display": "server/index.ts:92"
        },
        {
          "path": "server/index.ts",
          "line_start": 96,
          "line_end": 96,
          "snippet_hash": "9b7206f3d09a",
          "display": "server/index.ts:96"
        }
      ]
    },
    "required_secrets": [
      {
        "name": "DATABASE_URL",
        "referenced_in": [
          {
            "path": "drizzle.config.ts",
            "line_start": 3,
            "line_end": 3,
            "snippet_hash": "a19790628fbe",
            "display": "drizzle.config.ts:3"
          },
          {
            "path": "drizzle.config.ts",
            "line_start": 12,
            "line_end": 12,
            "snippet_hash": "1005be19f14a",
            "display": "drizzle.config.ts:12"
          },
          {
            "path": "server/db.ts",
            "line_start": 7,
            "line_end": 7,
            "snippet_hash": "a19790628fbe",
            "display": "server/db.ts:7"
          },
          {
            "path": "server/db.ts",
            "line_start": 13,
            "line_end": 13,
            "snippet_hash": "111f33de9945",
            "display": "server/db.ts:13"
          }
        ]
      },
      {
        "name": "AI_INTEGRATIONS_OPENAI_API_KEY",
        "referenced_in": [
          {
            "path": "server/replit_integrations/audio/client.ts",
            "line_start": 10,
            "line_end": 10,
            "snippet_hash": "05da5f1b1281",
            "display": "server/replit_integrations/audio/client.ts:10"
          },
          {
            "path": "server/replit_integrations/chat/routes.ts",
            "line_start": 6,
            "line_end": 6,
            "snippet_hash": "05da5f1b1281",
            "display": "server/replit_integrations/chat/routes.ts:6"
          },
          {
            "path": "server/replit_integrations/image/client.ts",
            "line_start": 6,
            "line_end": 6,
            "snippet_hash": "05da5f1b1281",
            "display": "server/replit_integrations/image/client.ts:6"
          }
        ]
      },
      {
        "name": "AI_INTEGRATIONS_OPENAI_BASE_URL",
        "referenced_in": [
          {
            "path": "server/replit_integrations/audio/client.ts",
            "line_start": 11,
            "line_end": 11,
            "snippet_hash": "1f70e6a77d42",
            "display": "server/replit_integrations/audio/client.ts:11"
          },
          {
            "path": "server/replit_integrations/chat/routes.ts",
            "line_start": 7,
            "line_end": 7,
            "snippet_hash": "1f70e6a77d42",
            "display": "server/replit_integrations/chat/routes.ts:7"
          },
          {
            "path": "server/replit_integrations/image/client.ts",
            "line_start": 7,
            "line_end": 7,
            "snippet_hash": "1f70e6a77d42",
            "display": "server/replit_integrations/image/client.ts:7"
          }
        ]
      }
    ],
    "external_apis": [
      {
        "api": "OpenAI",
        "evidence_files": [
          "server/replit_integrations/audio/client.ts:1",
          "server/replit_integrations/audio/routes.ts:3",
          "server/replit_integrations/chat/routes.ts:2",
          "server/replit_integrations/image/routes.ts:2",
          "server/replit_integrations/image/client.ts:2"
        ]
      }
    ],
    "deployment_assumptions": [
      "Binds to 0.0.0.0 (all interfaces)",
      "No Dockerfile - depends on Replit runtime or manual setup",
      "Requires 3 secret(s): DATABASE_URL, AI_INTEGRATIONS_OPENAI_API_KEY, AI_INTEGRATIONS_OPENAI_BASE_URL"
    ],
    "observability": {
      "logging": true,
      "health_endpoint": true,
      "evidence": [
        {
          "path": "script/build.ts",
          "line_start": 38,
          "line_end": 38,
          "snippet_hash": "2f74cc3fdab1",
          "display": "script/build.ts:38"
        },
        {
          "path": "shared/schema.ts",
          "line_start": 10,
          "line_end": 10,
          "snippet_hash": "6ccc8e5d45a7",
          "display": "shared/schema.ts:10"
        }
      ]
    },
    "limitations": [
      "No production container (Docker) or systemd evidence; assumed managed by Replit runner",
      "Port is mapped to 80 externally via Replit only; config for other platforms unknown"
    ]
  },
  "completeness": {
    "score": 85,
    "max": 100,
    "missing": [],
    "deductions": [
      "-15 for 6 unknown(s)"
    ],
    "notes": "-15 for 6 unknown(s); No Dockerfile found; 6 unknown(s) reported"
  }
}