{
  "prereqs": [
    "Node.js 20+ (or nodejs-20)",
    "npm",
    "PostgreSQL 14+",
    "yarn (alternative to npm, but npm shown as used)",
    "jq (for ops scripts; used in Replit/nix)",
    "unzip (Replit/nix)",
    "python3 (for forensic gate test in scripts/ci-forensic-gate.sh)",
    "tsx (TypeScript/ESM runner, installed as a devDependency)",
    "drizzle-kit (installed as devDependency)",
    "TypeScript (installed as devDependency)"
  ],
  "install_steps": [
    {
      "step": "Ensure Node.js 20+ is installed",
      "command": null,
      "evidence": {
        "path": "README.md",
        "line_start": 23,
        "line_end": 23,
        "snippet_hash": "def6eeff4ef7",
        "display": "README.md:23"
      }
    },
    {
      "step": "Ensure PostgreSQL database is available (version 14+ recommended)",
      "command": null,
      "evidence": {
        "path": "README.md",
        "line_start": 24,
        "line_end": 24,
        "snippet_hash": "953d061df568",
        "display": "README.md:24"
      }
    },
    {
      "step": "Install Node.js dependencies",
      "command": "npm install",
      "evidence": {
        "path": "README.md",
        "line_start": 29,
        "line_end": 29,
        "snippet_hash": "3a2dc0ae21eb",
        "display": "README.md:29"
      }
    },
    {
      "step": "Copy .env.example to .env for configuration",
      "command": "cp .env.example .env",
      "evidence": {
        "path": "README.md",
        "line_start": 33,
        "line_end": 33,
        "snippet_hash": "f91edca1f756",
        "display": "README.md:33"
      }
    },
    {
      "step": "Update DATABASE_URL and other variables in .env as needed",
      "command": "edit .env",
      "evidence": {
        "path": "README.md",
        "line_start": 34,
        "line_end": 34,
        "snippet_hash": "0af0ca748c51",
        "display": "README.md:34"
      }
    }
  ],
  "config": [
    {
      "name": "DATABASE_URL",
      "purpose": "PostgreSQL connection string for Drizzle ORM and app database",
      "evidence": {
        "path": ".env.example",
        "line_start": 5,
        "line_end": 5,
        "snippet_hash": "aeaa5d08ab01",
        "display": ".env.example:5"
      }
    },
    {
      "name": "API_KEY",
      "purpose": "API key used for authenticating private endpoints",
      "evidence": {
        "path": ".env.example",
        "line_start": 10,
        "line_end": 10,
        "snippet_hash": "eebb9b859fec",
        "display": ".env.example:10"
      }
    },
    {
      "name": "NODE_ENV",
      "purpose": "Sets environment (e.g. 'development' for local dev, 'production' for production build)",
      "evidence": {
        "path": ".env.example",
        "line_start": 13,
        "line_end": 13,
        "snippet_hash": "ad549f98b37b",
        "display": ".env.example:13"
      }
    },
    {
      "name": "PORT",
      "purpose": "Port for HTTP server to listen on (default 5000)",
      "evidence": {
        "path": ".env.example",
        "line_start": 14,
        "line_end": 14,
        "snippet_hash": "d1fd3ffd349f",
        "display": ".env.example:14"
      }
    },
    {
      "name": "TRANSCRIPT_MODE",
      "purpose": "Display mode for transcript: full, redacted, or hidden",
      "evidence": {
        "path": ".env.example",
        "line_start": 18,
        "line_end": 18,
        "snippet_hash": "520a3db1dbde",
        "display": ".env.example:18"
      }
    },
    {
      "name": "SESSION_SECRET",
      "purpose": "Session signing secret for security audit/session hashing",
      "evidence": {
        "path": ".env.example",
        "line_start": 23,
        "line_end": 23,
        "snippet_hash": "f7e2d4342e03",
        "display": ".env.example:23"
      }
    },
    {
      "name": "REPLIT_CONNECTORS_HOSTNAME",
      "purpose": "GitHub connector integration (optional, only if using GitHub connectors)",
      "evidence": {
        "path": ".env.example",
        "line_start": 27,
        "line_end": 27,
        "snippet_hash": "b992295a0561",
        "display": ".env.example:27"
      }
    },
    {
      "name": "REPL_IDENTITY",
      "purpose": "GitHub connector integration (optional, only if using GitHub connectors)",
      "evidence": {
        "path": ".env.example",
        "line_start": 28,
        "line_end": 28,
        "snippet_hash": "642899eba5a4",
        "display": ".env.example:28"
      }
    },
    {
      "name": "WEB_REPL_RENEWAL",
      "purpose": "GitHub connector integration (optional, only if using GitHub connectors)",
      "evidence": {
        "path": ".env.example",
        "line_start": 29,
        "line_end": 29,
        "snippet_hash": "30ec0e3c6118",
        "display": ".env.example:29"
      }
    },
    {
      "name": "CHECKPOINT_INTERVAL",
      "purpose": "Interval (N) for Ed25519 signed checkpoints (default 100 if unset)",
      "evidence": {
        "path": "STATE.md",
        "line_start": 118,
        "line_end": 118,
        "snippet_hash": "333069fdf796",
        "display": "STATE.md:118"
      }
    },
    {
      "name": "CHECKPOINT_ANCHOR_TYPE",
      "purpose": "Configures which anchor backend to use for checkpoint anchoring (log-only, S3WormAnchor, TSA, etc.)",
      "evidence": {
        "path": "replit.md",
        "line_start": 45,
        "line_end": 45,
        "snippet_hash": "d9991dc12248",
        "display": "replit.md:45"
      }
    }
  ],
  "run_dev": [
    {
      "step": "Run database schema migrations (Push schema to PostgreSQL)",
      "command": "npm run db:push",
      "evidence": {
        "path": "README.md",
        "line_start": 39,
        "line_end": 39,
        "snippet_hash": "cf82186f2a21",
        "display": "README.md:39"
      }
    },
    {
      "step": "Start the development server",
      "command": "npm run dev",
      "evidence": {
        "path": "README.md",
        "line_start": 44,
        "line_end": 44,
        "snippet_hash": "21f1677c8f4f",
        "display": "README.md:44"
      }
    }
  ],
  "run_prod": [
    {
      "step": "Build production bundle",
      "command": "npm run build",
      "evidence": {
        "path": "README.md",
        "line_start": 52,
        "line_end": 52,
        "snippet_hash": "290051cb4627",
        "display": "README.md:52"
      }
    },
    {
      "step": "Set NODE_ENV=production and start production server",
      "command": "npm run start",
      "evidence": {
        "path": "README.md",
        "line_start": 53,
        "line_end": 53,
        "snippet_hash": "505962fedbe9",
        "display": "README.md:53"
      }
    }
  ],
  "usage_examples": [
    {
      "description": "Check server health (no auth required, liveness)",
      "command": "curl http://localhost:5000/api/health",
      "evidence": "docs/API_CONTRACTS.md:11"
    },
    {
      "description": "Check readiness (DB and audit head, no auth required)",
      "command": "curl http://localhost:5000/api/ready",
      "evidence": "docs/API_CONTRACTS.md:24"
    },
    {
      "description": "Verify audit trail (API key required)",
      "command": "curl -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/audit/verify",
      "evidence": "docs/API_CONTRACTS.md:64"
    },
    {
      "description": "Get all receipts (API key required)",
      "command": "curl -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/receipts",
      "evidence": "docs/API_CONTRACTS.md:84"
    },
    {
      "description": "Create new receipt",
      "command": "curl -X POST -H \"x-api-key: <API_KEY>\" -H \"Content-Type: application/json\" http://localhost:5000/api/receipts -d '{ ... }'",
      "evidence": "docs/API_CONTRACTS.md:104"
    },
    {
      "description": "Verify a receipt's SHA-256 hash",
      "command": "curl -X POST -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/receipts/<id>/verify",
      "evidence": "docs/API_CONTRACTS.md:115"
    },
    {
      "description": "Lock a receipt (makes it immutable)",
      "command": "curl -X POST -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/receipts/<id>/lock",
      "evidence": "docs/API_CONTRACTS.md:137"
    },
    {
      "description": "Kill switch a receipt (irreversible)",
      "command": "curl -X POST -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/receipts/<id>/kill-switch",
      "evidence": "docs/API_CONTRACTS.md:125"
    }
  ],
  "verification_steps": [
    {
      "step": "Check health endpoint returns expected status",
      "command": "curl http://localhost:5000/api/health",
      "evidence": {
        "path": "STATE.md",
        "line_start": 204,
        "line_end": 204,
        "snippet_hash": "bcac425ad76e",
        "display": "STATE.md:204"
      }
    },
    {
      "step": "Check readiness endpoint returns DB/audit status",
      "command": "curl http://localhost:5000/api/ready",
      "evidence": {
        "path": "STATE.md",
        "line_start": 205,
        "line_end": 205,
        "snippet_hash": "b74c2dad109e",
        "display": "STATE.md:205"
      }
    },
    {
      "step": "Verify database schema was applied",
      "command": "npm run db:push",
      "evidence": {
        "path": "README.md",
        "line_start": 39,
        "line_end": 39,
        "snippet_hash": "cf82186f2a21",
        "display": "README.md:39"
      }
    },
    {
      "step": "Verify audit chain status with /api/audit/verify (status, checkedEvents, etc.)",
      "command": "curl -H \"x-api-key: <API_KEY>\" http://localhost:5000/api/audit/verify",
      "evidence": {
        "path": "STATE.md",
        "line_start": 206,
        "line_end": 206,
        "snippet_hash": "b0dfc20038ac",
        "display": "STATE.md:206"
      }
    },
    {
      "step": "Verify tamper detection using forensic pack (export, offline verify, detect tampering)",
      "command": "npx tsx scripts/export_forensic_pack.ts --output <pack.json> && npx tsx scripts/verify_forensic_pack.ts <pack.json>",
      "evidence": {
        "path": "scripts/ci-forensic-gate.sh",
        "line_start": 42,
        "line_end": 42,
        "snippet_hash": "d37376e1a8f9",
        "display": "scripts/ci-forensic-gate.sh:42"
      }
    },
    {
      "step": "Check application is serving on port 5000",
      "command": "curl http://localhost:5000",
      "evidence": {
        "path": "README.md",
        "line_start": 47,
        "line_end": 47,
        "snippet_hash": "a07ec05533ad",
        "display": "README.md:47"
      }
    }
  ],
  "common_failures": [
    {
      "symptom": "API key authentication failure (401 Unauthorized)",
      "cause": "Invalid or missing API_KEY in request headers",
      "fix": "Set correct API_KEY in the environment and include 'x-api-key' header",
      "evidence": {
        "path": "SECURITY.md",
        "line_start": 15,
        "line_end": 15,
        "snippet_hash": "37c573459866",
        "display": "SECURITY.md:15"
      }
    },
    {
      "symptom": "Database connection errors/crashes",
      "cause": "DATABASE_URL not set correctly, database offline, or wrong credentials/version",
      "fix": "Check DATABASE_URL and PostgreSQL service/version",
      "evidence": {
        "path": "drizzle.config.ts",
        "line_start": 3,
        "line_end": 3,
        "snippet_hash": "a19790628fbe",
        "display": "drizzle.config.ts:3"
      }
    },
    {
      "symptom": "Server not running or port 5000 unavailable",
      "cause": "Application failed to start, or port conflict",
      "fix": "Check logs, ensure PORT is 5000 and not in use",
      "evidence": {
        "path": ".replit",
        "line_start": 10,
        "line_end": 10,
        "snippet_hash": "47abfb4488e8",
        "display": ".replit:10"
      }
    },
    {
      "symptom": "Tampered forensic packs not detected as invalid",
      "cause": "Forensic verifier bug or pack not exported/verified correctly",
      "fix": "Re-export and verify with scripts/verify_forensic_pack.ts; ensure all scripts installed",
      "evidence": {
        "path": "scripts/ci-forensic-gate.sh",
        "line_start": 61,
        "line_end": 84,
        "snippet_hash": "bc535d235ce9",
        "display": "scripts/ci-forensic-gate.sh:61-84"
      }
    }
  ],
  "unknowns": [
    {
      "what_is_missing": "Exact step-by-step instructions for production deployment on non-Replit platforms",
      "why_it_matters": "For operations teams, precise systemd/nginx/docker or reverse proxy configuration may differ substantially from Replit",
      "what_evidence_needed": "Production deployment manual, Dockerfile, or PM2/NGINX config files"
    },
    {
      "what_is_missing": "Exact PostgreSQL schema initialization beyond drizzle-kit migration",
      "why_it_matters": "If custom database/user privileges are needed or for stateful multi-node deployments",
      "what_evidence_needed": "Database schema structure beyond ./shared/schema.ts or SQL schema/init scripts"
    },
    {
      "what_is_missing": "How API keys are generated/rotated and delivered out of band",
      "why_it_matters": "Long-term operations and key revocation require procedural step-by-step OpSec guidance",
      "what_evidence_needed": "Key management or rotation documentation"
    },
    {
      "what_is_missing": "How to view logs or troubleshoot failures interactively (log file paths or log commands)",
      "why_it_matters": "Operators need to track failures in production for support/troubleshooting",
      "what_evidence_needed": "Logging path or viewing instructions, referenced log locations"
    },
    {
      "what_is_missing": "Front-end or UI startup commands in non-Replit standalone environments",
      "why_it_matters": "Operators may need to serve the UI separately if not using the monorepo default",
      "what_evidence_needed": "Front-end build/start/manual or production UI hosting instructions"
    }
  ],
  "missing_evidence_requests": [
    "Production deployment details outside Replit (no Dockerfile, Compose, PM2, NGINX info found)",
    "Database initialization beyond drizzle-kit (no full schema SQL or privileged user instructions located)",
    "Key rotation procedure for API_KEY or SESSION_SECRET not detailed",
    "Detailed logging path/instructions not found",
    "Standalone front-end hosting commands not documented"
  ],
  "completeness": {
    "score": 70,
    "max": 100,
    "missing": [
      "port_behavior: no port evidence with verified snippet_hash"
    ],
    "deductions": [
      "-15 for 5 unknown(s)"
    ],
    "notes": "-15 for 5 unknown(s); No Dockerfile found; 5 unknown(s) reported"
  }
}