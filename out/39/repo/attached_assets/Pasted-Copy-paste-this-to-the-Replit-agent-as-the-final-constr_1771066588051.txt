Copy/paste this to the Replit agent as the **final constraint message**. It forces them to stop “narrating” and just deliver the proof artifacts.

---

## Replit Agent: FINAL INSTRUCTIONS (NO NARRATION)

**Hard rule:** Do **not** write “Let me…” or summaries. Do **not** claim tests passed unless you paste the command output proving it.
**Only allowed outputs:** shell commands you ran + their stdout/stderr + exact file contents requested.

### A) Confirm you’re importing the executing analyzer module (must succeed)

Run and paste output:

```bash
cd /home/runner/workspace
PYTHONPATH=server/analyzer/src python - <<'PY'
import analyzer as m
print(m.__file__)
PY
```

### B) Paste the exact source of these functions from the executing module

Run and paste output:

```bash
cd /home/runner/workspace
PYTHONPATH=server/analyzer/src python - <<'PY'
import analyzer as m, inspect
print("MODULE FILE:", m.__file__)
for fn in ["_safe_resolve_path","_read_lines_from_repo","_read_line_from_repo","_parse_evidence_string","_verify_single_evidence","_compute_completeness"]:
    print("\n---", fn, "---")
    print(inspect.getsource(getattr(m.Analyzer, fn)))
PY
```

### C) Run deterministic analysis into a clean folder

Run and paste output:

```bash
rm -rf /tmp/pta_out_final
cd /home/runner/workspace
python server/analyzer/analyzer_cli.py analyze --replit --no-llm -o /tmp/pta_out_final
ls -la /tmp/pta_out_final
```

### D) Prove “no invalid evidence” in outputs (line_start must never be < 1)

Run and paste output:

```bash
python - <<'PY'
import json, glob
paths=glob.glob("/tmp/pta_out_final/**/*.json", recursive=True)
bad=[]
def walk(x, where=""):
  if isinstance(x, dict):
    if "line_start" in x and isinstance(x["line_start"], int) and x["line_start"] < 1:
      bad.append((where, x))
    for k,v in x.items(): walk(v, where+f".{k}")
  elif isinstance(x, list):
    for i,v in enumerate(x): walk(v, where+f"[{i}]")
for p in paths:
  try: j=json.load(open(p))
  except: continue
  walk(j, p)
print("BAD line_start<1:", len(bad))
for where,ev in bad[:20]:
  print(where, ev)
PY
```

### E) Run the proof script and paste its output (must show PASS lines)

Create and run exactly:

```bash
cat > /tmp/pta_proof.py <<'PY'
import os, pathlib, json, tempfile
from pathlib import Path
import sys
sys.path.insert(0, "server/analyzer/src")
import analyzer as m

A = m.Analyzer.__new__(m.Analyzer)
A.MAX_FILE_SIZE = 2 * 1024 * 1024
A.MAX_SNIPPET_LINES = 50
A.BINARY_EXTENSIONS = getattr(m.Analyzer, "BINARY_EXTENSIONS", set())

# Test 1: symlink escape (leaf)
with tempfile.TemporaryDirectory() as td:
    tdir = Path(td)
    outside = tdir / "outside.txt"; outside.write_text("OUTSIDE\n")
    (tdir / "real.txt").write_text("REAL\n")
    os.symlink(str(outside), str(tdir / "link.txt"))
    A.repo_dir = tdir
    assert A._safe_resolve_path("real.txt") is not None
    assert A._safe_resolve_path("link.txt") is None
print("PASS: symlink escape (leaf)")

# Test 2: multi-line hashing
tdir = Path(tempfile.mkdtemp())
A.repo_dir = tdir
p = tdir / "multi.txt"
p.write_text("line1\nline2\nline3\nline4\nline5\n", encoding="utf-8")
ev = A._parse_evidence_string("multi.txt:2-4")
assert ev and ev["line_start"]==2 and ev["line_end"]==4
assert A._verify_single_evidence(ev) is True
print("PASS: multi-line hashing")

# Test 3: binary detection
b = tdir / "binary.txt"
b.write_bytes(b"\x00\x01\x02hello")
assert A._read_lines_from_repo("binary.txt", 1, 1) is None
print("PASS: binary detection")

# Test 4: output audit
out = Path("/tmp/pta_out_final")
bad=[]
for fp in out.rglob("*.json"):
    try:
        j=json.loads(fp.read_text())
    except Exception:
        continue
    def walk(x):
        if isinstance(x, dict):
            ls=x.get("line_start")
            if isinstance(ls,int) and ls<1:
                bad.append((str(fp),x))
            for v in x.values(): walk(v)
        elif isinstance(x, list):
            for v in x: walk(v)
    walk(j)
assert len(bad)==0
print("PASS: output audit (no line_start<1)")
PY

cd /home/runner/workspace
PYTHONPATH=server/analyzer/src python /tmp/pta_proof.py
```

### F) Paste these files verbatim (no edits, no summaries)

Use `sed` and paste raw output:

```bash
sed -n '1,260p' /tmp/pta_out_final/target_howto.json
cat /tmp/pta_out_final/coverage.json
```

---

### If anything fails:

Paste the **exact command + full stderr**. Do not guess. Do not describe what “should” happen.

---

Send that as-is. It will stop the agent from “performing completion” and force a real proof dump.
