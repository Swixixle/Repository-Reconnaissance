Below is a **direct Copilot task script**. Paste it into Copilot Chat in VS Code (or Cursor) inside the repo you want to ship (either a new `program-totality-analyzer` repo or wherever you’re extracting it).

---

## Copilot Instructions (DO EXACTLY)

### Goal

Create a GitHub-ready, functional “Program Totality Analyzer” repo with:

* working CLI
* clean import paths
* install + run instructions
* example outputs
* v0.1.0 tag-ready structure

### 0) Repo structure target

Create/confirm this layout at repo root:

```
.
├── README.md
├── LICENSE
├── pyproject.toml
├── server/
│   └── analyzer/
│       └── src/
│           ├── analyzer.py
│           ├── analyzer_cli.py
│           ├── __init__.py
│           ├── core/
│           │   ├── __init__.py
│           │   ├── acquire.py
│           │   ├── evidence.py
│           │   ├── replit_profile.py
│           │   └── ...
│           └── ...
├── examples/
│   ├── out/
│   │   ├── target_howto.sample.json
│   │   └── coverage.sample.json
│   └── README.md
└── scripts/
    └── smoke_test.sh
```

If files already exist elsewhere, **move them** to match this.

---

### 1) Fix imports so it runs anywhere (no “core not found”)

In `server/analyzer/src/analyzer.py` and any modules that say:

```python
from core.acquire import ...
```

Change to **package-relative imports**:

```python
from .core.acquire import acquire_target, AcquireResult
```

Likewise update all internal imports to use either:

* `from .core.xxx import ...` (preferred), or
* `from server.analyzer.src.core.xxx import ...` (acceptable but uglier)

Then ensure these exist:

* `server/analyzer/src/__init__.py`
* `server/analyzer/src/core/__init__.py`

---

### 2) Make the CLI runnable as a module

Ensure `server/analyzer/src/analyzer_cli.py` supports:

```bash
python -m server.analyzer.src.analyzer_cli --help
python -m server.analyzer.src.analyzer_cli analyze --replit -o /tmp/pta_out
```

If it currently only works as a file path invocation, update it.

Add:

```python
if __name__ == "__main__":
    app()
```

(or Typer equivalent) at bottom.

---

### 3) Add a console script entrypoint (so `pta` works after install)

Edit `pyproject.toml`:

* Ensure this is a python package (set name/version).
* Add a console script:

```toml
[project.scripts]
pta = "server.analyzer.src.analyzer_cli:app"
```

(If your CLI object isn’t called `app`, rename or adjust.)

---

### 4) Add functional smoke test script

Create `scripts/smoke_test.sh`:

Requirements:

* exits nonzero on failure
* runs CLI help
* runs deterministic analysis in a temp dir
* validates output json exists

Script:

* Create temp dir
* `pta --help`
* `pta analyze --replit -o "$TMP/out" --no-llm`
* Assert files exist:

  * `target_howto.json`
  * `coverage.json`
* Print “PASS” on success

Make it executable.

---

### 5) Add example output snapshots

Create `examples/out/` and commit:

* `target_howto.sample.json` (copy from your known good output)
* `coverage.sample.json`

Create `examples/README.md` explaining what these are.

---

### 6) Write README.md (functional, not fluffy)

README must include:

1. What it does
2. Install
3. Run (3 modes: github url, local folder, replit)
4. Deterministic mode (`--no-llm`)
5. Output files produced
6. Evidence model (hashing / file:line)
7. Troubleshooting:

   * missing DATABASE_URL
   * OpenAI vars
   * common “port already in use”

Do not mention internal agent stuff. Keep it operator-grade.

---

### 7) Ensure “file_exists” evidence is supported everywhere

Search for any logic that assumes evidence always has `line_start`.

* In completeness scoring and verification, ensure:

  * `kind == "file_exists"` is accepted as verified if file exists
  * it never tries to line-read those

---

### 8) Run locally in terminal and fix failures

After changes, run:

```bash
python -m pip install -e .
pta --help
pta analyze --replit -o /tmp/pta_out --no-llm
bash scripts/smoke_test.sh
```

If any step fails, fix until all succeed.

---

### 9) Prepare release commit + tag instructions (print for me)

After everything passes, output (in chat) the exact commands I should run:

* `git status`
* `git add -A`
* `git commit -m "PTA v0.1.0: deterministic dossier + evidence contract"`
* `git tag v0.1.0`
* `git push origin main --tags`

---

## Extra rule

Do not refactor logic unless required to fix packaging/entrypoints. Keep behavior identical.

---

If you paste the Copilot output back to me (or any errors you hit), I’ll tighten the repo into “release-grade” without widening scope.
