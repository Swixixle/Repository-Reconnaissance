{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://asset-analyzer.example.com/schemas/target_howto.schema.json",
  "title": "Target How-To JSON Schema",
  "description": "Schema for target_howto.json - the how-to guide output from PTA analyzer",
  "type": "object",
  "required": [
    "schema_version",
    "tool_version",
    "generated_at",
    "target",
    "prereqs",
    "install_steps",
    "config",
    "run_dev",
    "run_prod"
  ],
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Schema version for this output format",
      "pattern": "^[0-9]+\\.[0-9]+$"
    },
    "tool_version": {
      "type": "string",
      "description": "Version of the PTA tool that generated this output"
    },
    "generated_at": {
      "type": "string",
      "description": "ISO 8601 timestamp of when this output was generated",
      "format": "date-time"
    },
    "target": {
      "type": "object",
      "description": "Target repository/project information",
      "required": ["mode", "identifier"],
      "properties": {
        "mode": {
          "type": "string",
          "description": "Analysis mode",
          "enum": ["github", "local", "replit"]
        },
        "identifier": {
          "type": "string",
          "description": "Repository identifier (URL, path, etc.)"
        },
        "run_id": {
          "type": "string",
          "description": "Unique run identifier"
        }
      }
    },
    "prereqs": {
      "type": "array",
      "description": "Prerequisites needed to run this project",
      "items": { "type": "string" }
    },
    "install_steps": {
      "type": "array",
      "description": "Installation steps",
      "items": { "$ref": "#/definitions/step" }
    },
    "config": {
      "type": "array",
      "description": "Configuration steps",
      "items": { "$ref": "#/definitions/step" }
    },
    "run_dev": {
      "type": "array",
      "description": "Steps to run in development mode",
      "items": { "$ref": "#/definitions/step" }
    },
    "run_prod": {
      "type": "array",
      "description": "Steps to run in production mode",
      "items": { "$ref": "#/definitions/step" }
    },
    "usage_examples": {
      "type": "array",
      "description": "Usage examples",
      "items": { "$ref": "#/definitions/step" }
    },
    "verification_steps": {
      "type": "array",
      "description": "Verification steps",
      "items": { "$ref": "#/definitions/step" }
    },
    "common_failures": {
      "type": "array",
      "description": "Common failure scenarios",
      "items": { "$ref": "#/definitions/step" }
    },
    "unknowns": {
      "type": "array",
      "description": "Unknown or unclear aspects",
      "items": { "type": "string" }
    },
    "missing_evidence_requests": {
      "type": "array",
      "description": "Requests for missing evidence",
      "items": { "type": "string" }
    },
    "completeness": {
      "type": "object",
      "description": "Completeness metrics",
      "properties": {
        "total_fields": { "type": "integer" },
        "populated_fields": { "type": "integer" },
        "percentage": { "type": "number" }
      }
    }
  },
  "definitions": {
    "evidence": {
      "type": "object",
      "properties": {
        "path": { "type": "string" },
        "kind": { "type": "string" },
        "line_start": { "type": "integer" },
        "line_end": { "type": "integer" },
        "snippet_hash": { "type": "string" },
        "display": { "type": "string" }
      }
    },
    "step": {
      "type": "object",
      "properties": {
        "step": { "type": "string" },
        "command": { "type": "string" },
        "description": { "type": "string" },
        "evidence": {
          "oneOf": [
            { "$ref": "#/definitions/evidence" },
            {
              "type": "array",
              "items": { "$ref": "#/definitions/evidence" }
            }
          ]
        }
      }
    }
  }
}
