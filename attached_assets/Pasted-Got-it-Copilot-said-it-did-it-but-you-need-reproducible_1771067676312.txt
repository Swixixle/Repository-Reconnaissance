Got it. Copilot “said it did it,” but you need **reproducible, mechanical steps** that a Replit agent can execute (and that you can verify) — not narrative.

Below is a **single, concrete instruction block** you can paste to the Replit agent. It assumes your current reality:

* CLI currently lives at: `server/analyzer/analyzer_cli.py` (NOT under `src/`)
* Your python package code lives at: `server/analyzer/src/`
* Some imports are `from core...` and break when importing as a package
* You want: **`pta` console command + `python -m ...` + direct file execution** all working

---

## Paste this to Replit agent (verbatim)

### Objective

Make PTA installable + runnable in 3 ways:

1. `pta --help` (console script)
2. `python -m server.analyzer.src.analyzer_cli --help` (module invocation)
3. `python server/analyzer/analyzer_cli.py --help` (direct file)

Also add `scripts/smoke_test.sh`, `examples/out/*.sample.json`, and an operator-grade `README.md`.

### Rules

* No “try/except import hacks” unless absolutely necessary.
* Prefer **proper packages + relative imports**.
* Do not change analyzer behavior. Only packaging/entrypoints/docs.

---

### Step 1 — Confirm package init files exist

Create these files if missing (empty is fine):

* `server/analyzer/__init__.py`
* `server/analyzer/src/__init__.py`
* `server/analyzer/src/core/__init__.py`

Command:

```bash
mkdir -p server/analyzer/src/core
touch server/analyzer/__init__.py server/analyzer/src/__init__.py server/analyzer/src/core/__init__.py
```

---

### Step 2 — Fix `core` import break (the reason you saw ModuleNotFoundError)

Right now `server/analyzer/src/analyzer.py` imports `core.acquire` etc, which only works when `src/` is manually on PYTHONPATH.

**Replace all `from core...` and `import core...` inside `server/analyzer/src/**` with relative imports.**

Example conversions:

* `from core.acquire import ...` → `from .core.acquire import ...`
* `from core.evidence import ...` → `from .core.evidence import ...`
* `import core.replit_profile as rp` → `from .core import replit_profile as rp`

Command to find offenders:

```bash
grep -RIn --exclude-dir=node_modules --exclude-dir=.git "from core\.|import core\." server/analyzer/src
```

Then edit each file and fix imports.

---

### Step 3 — Make a single canonical CLI module in `src/`

Create: `server/analyzer/src/analyzer_cli.py`

This file should be the *only* “real” CLI implementation.

Then update the root CLI `server/analyzer/analyzer_cli.py` to become a **thin wrapper** that imports and runs the src CLI.

#### 3A) `server/analyzer/src/analyzer_cli.py`

* Must define Typer app: `app = typer.Typer(...)`
* Must end with:

```python
if __name__ == "__main__":
    app()
```

* Must import Analyzer using package-relative import:

```python
from .analyzer import Analyzer
```

#### 3B) wrapper file `server/analyzer/analyzer_cli.py`

Replace contents with:

```python
from server.analyzer.src.analyzer_cli import app

if __name__ == "__main__":
    app()
```

No sys.path hacks. No environment assumptions.

---

### Step 4 — Add module entrypoint (optional but clean)

Create `server/analyzer/src/__main__.py`:

```python
from .analyzer_cli import app

if __name__ == "__main__":
    app()
```

This allows:

```bash
python -m server.analyzer.src --help
```

---

### Step 5 — Configure `pyproject.toml` for console script

In repo root `pyproject.toml`, ensure:

* project name/version exist
* includes packages so `server` is importable
* console script:

```toml
[project.scripts]
pta = "server.analyzer.src.analyzer_cli:app"
```

If you’re using setuptools, ensure package discovery includes `server`. If using hatch/poetry, set packages accordingly.

Then test editable install:

```bash
python -m pip install -e .
pta --help
```

---

### Step 6 — Smoke test script

Create `scripts/smoke_test.sh`:

Requirements:

* `set -euo pipefail`
* verifies all 3 invocation methods
* runs deterministic analysis and checks output files exist

Minimum script:

```bash
#!/usr/bin/env bash
set -euo pipefail

TMP="$(mktemp -d)"
OUT="$TMP/out"

echo "1) pta --help"
pta --help >/dev/null

echo "2) python -m server.analyzer.src --help"
python -m server.analyzer.src --help >/dev/null

echo "3) python server/analyzer/analyzer_cli.py --help"
python server/analyzer/analyzer_cli.py --help >/dev/null

echo "4) deterministic run"
pta analyze --replit -o "$OUT" --no-llm

test -f "$OUT/target_howto.json"
test -f "$OUT/coverage.json"

echo "PASS"
```

Then:

```bash
chmod +x scripts/smoke_test.sh
bash scripts/smoke_test.sh
```

---

### Step 7 — Examples snapshot

Create:

* `examples/out/target_howto.sample.json`
* `examples/out/coverage.sample.json`

Generate fresh:

```bash
rm -rf /tmp/pta_out_sample
pta analyze --replit -o /tmp/pta_out_sample --no-llm
mkdir -p examples/out
cp /tmp/pta_out_sample/target_howto.json examples/out/target_howto.sample.json
cp /tmp/pta_out_sample/coverage.json examples/out/coverage.sample.json
```

Commit these.

---

### Step 8 — README.md (operator-grade)

Write README sections:

* What PTA does
* Install (`pip install -e .`)
* Run modes:

  * GitHub URL
  * local path
  * `--replit`
* Deterministic mode: `--no-llm`
* Outputs (target_howto.json, coverage.json, etc)
* Evidence model (snippet_hash, line_start/line_end, file_exists)
* Troubleshooting:

  * `ModuleNotFoundError: core`
  * missing env vars (`DATABASE_URL`, etc)
  * port conflicts

---

### Step 9 — Final verification commands (must paste results)

Run and paste outputs:

```bash
python -m pip install -e .
pta --help | head
python -m server.analyzer.src --help | head
python server/analyzer/analyzer_cli.py --help | head
bash scripts/smoke_test.sh
```

If all pass, repo is “functional and shippable”.

---

## Why Copilot “said it worked” but you still saw failures

* Your first attempt imported `server.analyzer.src.analyzer` directly, which triggered `from core.acquire...` and failed because `core` wasn’t a real package on sys.path.
* Your later `PYTHONPATH=server/analyzer/src python ...` worked because you *manually* made `core` importable. That’s not shippable.
* The fix is what you already proved in the live dump: **relative imports + real packaging**.

---

If you want to “wrap this up” even harder: after the Replit agent runs those steps, have it paste **only** the output of Step 9. That’s your proof that the setup is actually functional (not “agent narrative”).
